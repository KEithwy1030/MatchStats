-- 创建比赛预测表
CREATE TABLE IF NOT EXISTS match_predictions (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    match_id INTEGER NOT NULL,
    prediction_date TIMESTAMPTZ DEFAULT NOW(),

    -- 比赛信息
    home_team TEXT NOT NULL,
    away_team TEXT NOT NULL,
    league TEXT NOT NULL,
    match_date TIMESTAMPTZ NOT NULL,

    -- AI 预测结果
    predicted_winner TEXT, -- 主胜/平局/客胜
    predicted_score TEXT,
    confidence DECIMAL(5,2), -- 0-100
    reasoning TEXT,

    -- 原始数据
    raw_response TEXT,
    prompt TEXT,

    -- 元数据
    ai_model TEXT DEFAULT 'Grok',
    ai_provider TEXT DEFAULT 'xAI',

    -- 验证（比赛结束后填写）
    actual_winner TEXT,
    actual_score TEXT,
    is_correct BOOLEAN,

    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),

    CONSTRAINT predictions_match_unique UNIQUE (match_id)
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_predictions_match_id ON match_predictions(match_id);
CREATE INDEX IF NOT EXISTS idx_predictions_date ON match_predictions(match_date);
CREATE INDEX IF NOT EXISTS idx_predictions_league ON match_predictions(league);

-- 添加注释
COMMENT ON TABLE match_predictions IS 'AI 比赛预测结果';
COMMENT ON COLUMN match_predictions.predicted_winner IS '预测胜者: 主胜/平局/客胜';
COMMENT ON COLUMN match_predictions.confidence IS '预测置信度: 0-100';
COMMENT ON COLUMN match_predictions.is_correct IS '预测是否正确（比赛结束后验证）';
